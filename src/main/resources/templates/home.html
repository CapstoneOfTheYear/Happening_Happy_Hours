<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<header th:include="partials :: header(title = 'Home')"></header>

<nav th:include="partials :: navbar"></nav>

<body>
<!--Mapbox tags-->
<script src='https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css' rel='stylesheet'/>


<!--Mapbox Location: Downtown San Antonio-->
<div id='map' style='width: 1400px; height: 500px;'></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0eW91bmcyMDIyIiwiYSI6ImNreXhoMmdmajBpZjUyb3B0NXZuZWlobGgifQ.Gf2quu65rVOKGGqEiSqcOA';
    var map = new mapboxgl.Map({
        container: 'map', // How the map is put in the div for viewing purposes
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-98.4916, 29.4252],
        zoom: 12
    });

    // hard coded marker
    var marker = new mapboxgl.Marker()
        .setLngLat([-98.4916, 29.4260])
        .addTo(map);

    // marker object
</script>
</body>
<!--<head>
    <meta charset="UTF-8">
    <title>First Weather Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../main.css">

    &lt;!&ndash; Mapbox CSS &ndash;&gt;
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
</head>
<body>
<div id='map'></div>

<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

<div class="row">
    <div class="card-body" id="location"></div>
</div>

<pre id="coordinates" class="coordinates"></pre>
&lt;!&ndash;<input class="search" id="userInput" type="text">&ndash;&gt;
&lt;!&ndash;<button id="button" type="button">Search</button>&ndash;&gt;
<div id="menu">
    <input id="satellite-v9" type="radio" name="rtoggle" value="satellite">
    <label class="map-style" for="satellite-v9">Satellite</label>
    <input id="light-v10" type="radio" name="rtoggle" value="light">
    <label class="map-style" for="light-v10">Light</label>
    <input id="dark-v10" type="radio" name="rtoggle" value="dark">
    <label class="map-style" for="dark-v10">Dark</label>
    <input id="streets-v11" type="radio" name="rtoggle" value="streets" checked="checked">
    <label class="map-style" for="streets-v11">Streets</label>
    <input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors">
    <label class="map-style" for="outdoors-v11">Outdoors</label>
</div>

<div id="weather"></div>

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet'
      href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css'
      type='text/css'/>
<div class="btn">
    <label class="zoom">ZOOM</label>
    <button id="zoom5" value="zoom x 5">X 5</button>
    <button id="zoom10" value="zoom x 10">X 10</button>
    <button id="zoom15" value="zoom x 15">X 15</button>
&lt;!&ndash;    <button class="removeMarkers" id="pop" value="popup">Remove Markers</button>&ndash;&gt;
</div>
<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
        crossorigin="anonymous"></script>
<script>
    mapboxgl.accessToken = token;
    var accessToken = token;
    const coordinates = document.getElementById('coordinates');
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v10',
        center: [-98.4916, 29.4252],
        zoom: 8
    });
    const layerList = document.getElementById('menu');
    const inputs = layerList.getElementsByTagName('input');

    for (const input of inputs) {
        input.onclick = (layer) => {
            const layerId = layer.target.id;
            map.setStyle('mapbox://styles/mapbox/' + layerId);
        };
    }
    const nav = new mapboxgl.NavigationControl({
        showZoom: true
    });

    $(document).ready(function () {
        $('#zoom5').click(function (e) {
            map.flyTo({zoom: 5});
        });
        $(document).ready(function () {
            $('#zoom10').click(function (e) {
                map.flyTo({zoom: 10});
            });
            $(document).ready(function () {
                $('#zoom15').click(function (e) {
                    map.flyTo({zoom: 15});
                })
            });
        });
    });


    $(document).ready(function () {
        $(".removeMarkers").click(function () {
            $('svg').toggle()
        });
    });

    $.get("http://api.openweathermap.org/data/2.5/forecast", {
        APPID: weathertoken,
        lat:    29.423017,
        lon:   -98.48527,
        units: "imperial"
    }).done(function(data) {
        console.log('5 day forecast', data);
    })

    const marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([-98.4916, 29.4252])
        .addTo(map);

    function onDragEnd() {
        const lngLat = marker.getLngLat();
        coordinates.style.display = 'block';
        coordinates.innerHTML = `Longitude: ${lngLat.lng}<br />Latitude: ${lngLat.lat}`;
    }

    const geocoder = new MapboxGeocoder({
        mapboxgl: mapboxgl,
        accessToken: mapboxgl.accessToken,
        marker: false
    })

    geocoder.on('result', e => {
        const marker = new mapboxgl.Marker({
            draggable: true
        })
            .setLngLat(e.result.center)
            .addTo(map)
        marker.on('dragend', function (e) {
            var lngLat = e.target.getLngLat();
            console.log(lngLat['lat'])
            console.log(lngLat['lng'])
        })
    })
    // map.addControl(geocoder)

    marker.on('dragend', function() {
        var lat = marker.getLngLat().lat
        var lng = marker.getLngLat().lng
        var currentLocation = [lat, lng]
        console.log(currentLocation);
        $('#weather').empty();
        weather(currentLocation)
    })
    //search function
    $('#button').click(function(e){
        var userInput = $('#userInput').val()
        console.log(userInput);
        var searchLocation = geocode(userInput, token);
        searchLocation.then(function(coordinates){
            console.log(coordinates)
            var searchLat = coordinates[0];
            var searchLng = coordinates[1];
            var userCoordinates = [searchLat, searchLng];
            console.log(userCoordinates);
            $('#weather').empty();
            marker.setLngLat(userCoordinates);
            weather([searchLng, searchLat]);

            map.flyTo({
                center:[coordinates[0], coordinates[1]]
            })
        });
    })

    function weather(x) {
        $.ajax(`https://api.openweathermap.org/data/2.5/onecall?units=imperial&lat=${x[0]}&lon=${x[1]}&exclude=current, hourly, minutely&appID=${weathertoken}`).done(function (resp) {
            console.log(resp)

            for (var i = 0; i <= 4; i++) {
                var todayDate = new Date(resp.daily[i].dt * 1000).toDateString();
                var weatherDiv = '';
                console.log(todayDate);
                var currentTemp = resp.daily[i].temp.day.toFixed(0);
                weatherDiv += '<div class="card col-5 card-header" style="width: 18em;">' + todayDate
                weatherDiv += '<div class="list-group-item">' + "Current Temperature: " + currentTemp + '</div>'
                weatherDiv += '<div class="list-group-item">' + "Description: " + resp.daily[i].weather[0].description + '</div>'
                weatherDiv += '<div class="list-group-item">' + '<img src=http://openweathermap.org/img/w/' + resp.daily[0].weather[0].icon + '.png></div>'
                weatherDiv += '<div class="list-group-item">' + "Humidity %" + resp.daily[i].humidity + '</div>'
                weatherDiv += '<div class="list-group-item">' + "Wind Speed: " + resp.daily[i].wind_speed + '</div>'
                weatherDiv += '<div class="list-group-item">' + "Pressure: " + resp.daily[i].pressure + '</div>'
                weatherDiv += '</div>'
                weatherDiv += '</div>'


                $('#weather').append(weatherDiv);
                console.log(weatherDiv);
            }
        });
    }

    var saCoordinates = [29.4241, -98.4936];
    weather(saCoordinates);

    function geocode(search, token) {
        var baseUrl = 'https://api.mapbox.com';
        var endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
            .then(function (res) {
                return res.json();
                // to get all the data from the request, comment out the following three lines...
            }).then(function (data) {
                return data.features[0].center;
            });
    }
</script>-->

<footer th:replace="partials :: footer"></footer>

</html>